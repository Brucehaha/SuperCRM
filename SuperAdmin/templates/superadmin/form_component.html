{% load list_display %}
{% load static %}

    <form method="post" onsubmit="SelectOption()" enctype="multipart/form-data" target="img-preview">{% csrf_token %}
            {{ form.errors }}
            {% if not admin_class.form_add %}
                {% for field_name in admin_class.readonly_fields %}
                    <div class="form-group">
                        <div class="row">
                            <div class="col-lg-4">
                                <label for="id_{{ field_name }}">{{ field_name|title }}</label>
                                <input class="form-control" disabled id= "id_{{ field_name }}" value="{% get_readonly_value form_obj field_name %}"/>
                             </div>
                        </div>
                    </div>

                {% endfor %}
            {% endif %}

            {% for field in form_obj %}
                {% if field.name in admin_class.filter_horizontal %}
                    <div class="form-group">
                        <label for="id_{{ field.name }}">{{ field.label }}</label>

                        <div class="row">

                            <div class="col-lg-5">
                                <select id="id_{{ field.name }}_from" multiple class="form-control">
                                    {% get_m2m_avalaible_data field.name form_obj admin_class as avl_data %}
                                    {% for v in avl_data %}
                                      <option ondblclick="MoveOption(this, 'id_{{ field.name }}_to')" value="{{ v.id }}">{{ v }}</option>
                                    {% endfor %}

                                </select>
                            </div>
                            <div class="col-lg-5">
                                <select tag="selected_value" name="{{ field.name }}" id="id_{{ field.name }}_to" multiple class="form-control">
                                {% get_selected_m2m_data field.name form_obj as selected_data %}
                                 {% for v in selected_data %}
                                  <option ondblclick="MoveOption(this, 'id_{{ field.name }}_from')"  value="{{ v.id }}">{{ v }}</option>
                                {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>

                {% elif field.name in admin_class.image_fields %}
                    <div class="all-pic">
                    {% render_image form_obj field.name as url %}
                        {% if url %}
                        <div class="initLoading" style="display:none;">
                            <img src="/static/superadmin/imgs/im_loading.gif" alt="" class="releaseImg">
                        </div>
                        <div class="check-pic">
                            <div class="show-img">
                                <div class="reupload-hover">
                                    <a href="javscript:void(0)" class="reupdate">
                                    <img class='pic' src="{{ url }}">

                                    </a>
                                </div>
                           </div>
                        </div>{% endif %}
                        <div class="upload-file">

                            <label for="id-{{ field.name }}" class="upload-label">
                                <input type="file" name="{{ field.name }}" id="id-{{field.name}}" style="display:none" onchange="updateImage()">
                             </label>

                        </div>

                   </div>


                {% else %}
                    <div class="form-group"  style="clear:left;">
                        <div class="row">
                        <div class="col-lg-4">
                            <label for="id_{{ field.name }}">{{ field.label }}</label>
                                {{ field }}
                        </div>
                        </div>
                     </div>
                {% endif %}
                    <span style="color: red">{{ field.errors.0 }} </span>
            {% endfor %}
                    <div class="form-group">

            <div class="col-sm-offset-4 col-sm-2" style="clear:left;">
              <button type="submit" class="btn btn-info">Save</button>
            </div>
            </div>
   </form>
    <style>
    .check-pic {
        width: 140px;
        height: 140px;
        position: relative;
        float: left;
        margin-right: 6px;
    }
     .upload-file {
        position: relative;
        width: 140px;
        height: 140px;
        float:left;
        margin-right: 6px;
        background: url(/static/superadmin/imgs/upload.png) no-repeat center #f5f5f5;
        background-size: 42px;


     }
     .upload-label {
        display: block;
        cursor: pointer;
        width: 100%;
        height: 100%;
     }

     .show-img {
         box-sizing: border-box;

     }
     .reupload-hover {
         width: 140px;
        height: 140px;
        display: block;
     }
     .reupdate {
        width: 140px;
        height: 140px;
        display: block;
        background-color: #f5f5f5;
     }
     .initLoading .pic {
        display:block;
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        top: 0;
        margin: auto;
        }
    </style>
    <script>
        function MoveOption(that, id) {
            var to_parent_id = $(that).parent().attr('id');
            console.log(to_parent_id)
            var option = "<option value='" + $(that).val() +"'ondblclick=MoveOption(this,'"+ to_parent_id +"') >" + $(that).text() +"</option>";
            $('#'+ id).append(option);
            $(that).remove();
        }
        function SelectOption() {
            $("select[tag] option").prop('selected', true);
        }
        function updataImage() {
            var form = new FormData()

            $.ajax({


            })
        }
    </script>
